<div class="row">
  <div class="col-md-1"></div>
  <div class="col-md-2"><button type="button" class="btn btn-warning" (click)="goBack()"><i class="fa fa-chevron-left"><a> Retour</a></i></button></div>
  <div class="col-md-6"><h3 class="title">Ajouter / Éditer un Projet</h3></div>
  <div class="col-md-3"></div>
</div>

<div class="container">
  <!-- <div class="goldgradient beigeborder subnav">
    <button class="subnav-btnleft" (click)="goBack()"><i class="fa fa-chevron-left"></i></button>
    <h3 style="text-align: center;">Add/Edit Project</h3>
  </div> -->
  <div>

    <form [formGroup]="myForm" novalidate (ngSubmit)="save()" (keydown.enter)="$event.preventDefault()">

      <div>
        <div>
          <label>Id</label>
          {{fetchedProject._id}}
        </div>
      </div>
      <!-- cascade -->
      <div>
        <select class="form-control col-md-3" [ngModelOptions]="{standalone: true}" [(ngModel)]="categ1" (ngModelChange)="changeCascade(categ1Index.selectedIndex, 0)" #categ1Index>
          <option *ngFor="let n of itemSteps" [attr.value]="n.categ">{{n.categ}}</option>
        </select>
      </div>
      <div [hidden]="itemSteps[selectedIndex1].categ==''">
        <select class="form-control col-md-3" [ngModelOptions]="{standalone: true}" [(ngModel)]="categ2" (ngModelChange)="changeCascade(categ1Index.selectedIndex, categ2Index.selectedIndex)" #categ2Index>
          <option *ngFor="let n of itemSteps[selectedIndex1].subCateg" [attr.value]="n.categ">{{n.categ}}</option>
        </select>
      </div>
      <div [hidden]="itemSteps[selectedIndex1].subCateg[selectedIndex2].categ==''">
        <select class="form-control col-md-3" [ngModelOptions]="{standalone: true}" [(ngModel)]="categ3">
          <option *ngFor="let n of itemSteps[selectedIndex1].subCateg[selectedIndex2].subCateg" [attr.value]="n.categ">{{n.categ}}</option>
        </select>
      </div>
      <!-- cascade -->

      <a [routerLink]="['/project/tasks/' + fetchedProject._id]" class="admn-btn">
        Taches
      </a>

      <div class="form-group">

        <div class="phyto-ctnr ttl-cde">
          <label>Nom</label>
          <input class="form-control col-md-4" type="text" formControlName="name" [(ngModel)]="fetchedProject.details.name" placeholder="Ref">
        </div>
      </div>
      <div class="form-group phyto-ctnr ttl-cde">
        <label>Description</label>
        <input class="form-control col-md-4" type="text" formControlName="description" placeholder="description" [(ngModel)]="fetchedProject.details.description">
      </div>


      <div class="FormGroup whtxt">
        <a class="btn btn-primary" (click)="addCalendar()">
         <i class="fa fa-calendar" aria-hidden="true"></i>
         <span>Choisir Date</span>
        </a>
      </div>
      <div class="FormGroup whtxt">
        <a class="btn btn-warning" (click)="seeCalendar()">
         <i class="fa fa-calendar" aria-hidden="true"></i>
         <span>Voir calendrier du Projet</span>
        </a>
      </div>
      <!-- Autocomplete User-->
      <label>Client</label>
      <div>

          <!-- <input class="form-control" *ngIf="!search.typeUser.length" [ngModelOptions]="{standalone: true}" -->

          <input class="form-control col-md-3" [ngModelOptions]="{standalone: true}"

          [(ngModel)]="autocompleteUser"
          placeholder="Select"
          (ngModelChange)="searchUsers()"
          mdInput>
        </div>
        <div class="form-control col-md-3" *ngFor="let user of fetchedUsers; let i=index">
         <table>
            <tr>
              <td class="tdbtn1">{{user.profile.name}} - {{user.profile.lastName}}</td>
              <td class="tdbtn2"><button class="btn btn-success" type="button" (click)="selectUser(user)">select</button></td>
            </tr>
          </table>
        </div>
        <div class="form-control col-md-3" *ngFor="let user of fetchedProject.clients; let i=index">
          <table>
            <tr>
              <td class="tdbtn1">{{user.profile.name}} - {{user.profile.lastName}}</td>
              <td class="tdbtn2"><button class="btn btn-danger btn-sm ferme" type="button" (click)="removeUser(i)"><i class="fa fa-times"></i></button></td>
            </tr>
          </table>
        </div>
      <!--
      <input
        *ngIf="!fetchedProject.clients.length"
        [ngModelOptions]="{standalone: true}"
        [(ngModel)]="autocompleteUser"
        placeholder="Select"
        (ngModelChange)="searchUsers()"
        mdInput
      >
      <div *ngFor="let user of fetchedUsers; let i=index">
        {{user.profile.name}} - {{user.profile.lastName}}
        <button type="button" (click)="selectUser(user)">select</button>
      </div>
      <div *ngIf="fetchedUsers.length == 0 && autocompleteUser !=''">
          Pas de resultats,
          <a [routerLink]="['/user/newuser']" class="admn-btn">
            Créer un nouveau client
          </a>
      </div>
      <div *ngFor="let user of fetchedProject.clients; let i=index">
        {{user.profile.name}} - {{user.profile.lastName}}
        <button type="button" (click)="removeUser(i)"><i class="fa fa-times"></i></button>
      </div> -->
      <!-- Autocomplete User -->


      <br>
      <div *ngIf="fetchedProject._id">
        <div *ngFor="let user of fetchedProject.clients">
          <label>Devis</label>


          <app-quotes
            [showHeader]=false
            [userId]="user._id"
            [projectId]="fetchedProject._id"></app-quotes>
          <!-- <app-projects [userId]="fetchedUser._id"></app-projects> -->



        </div>
      </div>



      <div class="form-group prmimg-cnt">

        <!-- <input type="hidden" class="form-control" formControlName="_id" [(ngModel)]="fetchedProject.form._id"> -->
        <div *ngFor="let singleForm of fetchedProject.forms; let i=index;">
          <img class="promo-img" src="./uploads/forms/{{singleForm.owner}}/{{singleForm.imagePath}}" onerror="this.src ='assets/images/no-image-found.jpg'">
          <button type="button" md-button (click)="removePic(i)">
            <i class="fa fa-times"></i>
          </button>
        </div>
        <div>
          <button type="button" md-button (click)="openDialog('img')" class="addpic-squr">
            Add Picture
            <br>
            <i class="fa fa-plus"></i>
          </button>
        </div>
      </div>




      <div class="form-group">
      <select class="form-control col-md-3"
        formControlName="status"
        [(ngModel)]="fetchedProject.status">
        <option *ngFor="let n of status" [ngValue]="n.index">{{n.label}}</option>
      </select>
    </div>




    <div class="form-group">
    <!-- Autocomplete AssignedTo-->
    <label>Assigned To</label>
    <input class="form-control col-md-3"
      *ngIf="!fetchedProject.assignedTos.length"
      [ngModelOptions]="{standalone: true}"
      [(ngModel)]="autocompleteAssignedTo"
      placeholder="Select"
      (ngModelChange)="searchAssignedTos()"
      mdInput
    >
    <div *ngFor="let user of fetchedAssignedTos; let i=index">
      {{user.profile.name}} - {{user.profile.lastName}}
      <button type="button" (click)="selectAssignedTo(user)">select</button>
    </div>
    <div *ngIf="fetchedAssignedTos.length == 0 && autocompleteAssignedTo !=''">
        Pas de resultats,
        <a [routerLink]="['/user/newuser']" class="admn-btn">
          Créer un nouveau employe
        </a>
    </div>


    <div *ngFor="let user of fetchedProject.assignedTos; let i=index">
      {{user.profile.name}} - {{user.profile.lastName}}
      <button type="button" (click)="removeAssignedTo(i)"><i class="fa fa-times"></i></button>
    </div>
    <!-- Autocomplete User -->
  </div>


    <div class="valid-edit">
      <button type="submit" class="done btn btn-success" [disabled]="!myForm.valid">Valider</button>
      <button
        *ngIf="fetchedProject._id"
        type="button"
        class="delete"
        md-button
        (click)="openDialogDelete()">
        Delete
      </button>
    </div>
    <div class="clearfix"></div>
  </form>
</div>
